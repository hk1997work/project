<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>ecoSignal | Dashboard</title>

    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet"/>
    <link href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" rel="stylesheet"/>
    <link href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" rel="stylesheet"/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

    <link rel="stylesheet" href="project.css">
</head>
<body>
<nav class="project-nav-bar">
    <div class="nav-left">
        <div class="nav-capsule-box">
            <a class="nav-logo" href="index.html">
                <div class="logo-icon-box"><i data-lucide="activity"></i></div>
                <span>ecoSignal</span>
            </a>
            <div class="nav-divider"></div>
            <div class="breadcrumb-group">
                <div class="crumb-wrapper" id="project-wrap">
                    <button class="crumb-btn" onclick="toggleMenu('project-wrap')">
                        <span class="block-anim" id="label-project">Loading...</span>
                        <i data-lucide="chevron-down" size="14"></i>
                    </button>
                    <div class="crumb-dropdown" id="dropdown-project">
                        <div class="dropdown-search-box">
                            <div class="search-input-wrapper">
                                <i class="search-icon-small" data-lucide="search"></i>
                                <input class="dropdown-input" onclick="event.stopPropagation()" oninput="handleSearchProject(this.value)" placeholder="Search..." type="text">
                            </div>
                        </div>
                        <div class="dropdown-list-scroll" id="project-list-container"></div>
                    </div>
                </div>
                <span class="crumb-separator">/</span>
                <div class="crumb-wrapper" id="collection-wrap">
                    <button class="crumb-btn" onclick="toggleMenu('collection-wrap')">
                        <span class="block-anim" id="label-collection">Loading...</span>
                        <i data-lucide="chevron-down" size="14"></i>
                    </button>
                    <div class="crumb-dropdown" id="dropdown-collection">
                        <div class="dropdown-search-box">
                            <div class="search-input-wrapper">
                                <i class="search-icon-small" data-lucide="search"></i>
                                <input class="dropdown-input" onclick="event.stopPropagation()" oninput="handleSearchCollection(this.value)" placeholder="Search..." type="text">
                            </div>
                        </div>
                        <div class="dropdown-list-scroll" id="collection-list-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="nav-center">
        <div class="nav-capsule-box">
            <div class="sliding-pill" id="nav-sliding-pill"></div>
            <button class="nav-item active" onclick="switchTab(this, 'desc')">Description</button>
            <button class="nav-item" onclick="switchTab(this, 'summary')">Summary</button>
            <button class="nav-item" onclick="switchTab(this, 'media')">Media</button>
            <button class="nav-item" onclick="switchTab(this, 'map')">Map</button>
            <button class="nav-item" onclick="switchTab(this, 'timeline')">Timeline</button>
            <button class="nav-item" onclick="switchTab(this, 'data')">Data</button>
        </div>
    </div>
    <div class="nav-right">
        <div class="nav-capsule-box">
            <button class="nav-btn-simple" onclick="toggleTheme()" title="Switch Theme">
                <i data-lucide="moon" id="theme-icon-el" size="20"></i>
            </button>
            <div class="nav-divider"></div>
            <button class="nav-btn-simple" title="Information"><i data-lucide="info" size="20"></i></button>
            <div class="nav-divider"></div>
            <div class="user-wrapper" id="user-menu">
                <div class="user-capsule-btn" onclick="toggleUserMenu()">
                    <div class="user-avatar-icon"><i data-lucide="user" size="16"></i></div>
                    <span class="user-name-text">Liudilong</span>
                    <i class="chevron-icon" data-lucide="chevron-down" size="14"></i>
                </div>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="#"><i data-lucide="settings" size="18"></i>Settings</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item danger" href="index.html"><i data-lucide="log-out" size="18"></i>Logout</a>
                </div>
            </div>
        </div>
    </div>
</nav>
<div class="content-wrapper">
    <div class="tab-page active" id="tab-desc">
        <div class="desc-layout" id="desc-layout-container">
            <div class="panel-anim" id="panel-proj-desc">
                <div class="desc-header-section block-anim">
                    <div class="title-row">
                        <h1 class="desc-title-text" id="desc-project-title">Loading...</h1>
                        <a class="title-link-icon" href="#" id="meta-link" target="_blank" title="Visit Project Website"><i data-lucide="link"></i></a>
                    </div>
                    <div class="meta-row">
                        <div class="meta-capsule-box">
                            <div class="meta-item-btn" title="Creator">
                                <div class="meta-item-icon"><i data-lucide="user" size="14"></i></div>
                                <span id="meta-creator-name">...</span>
                            </div>
                            <div class="meta-divider"></div>
                            <div class="meta-item-btn" title="Creation Date">
                                <div class="meta-item-icon"><i data-lucide="calendar" size="14"></i></div>
                                <span id="meta-date">...</span>
                            </div>
                            <div class="meta-divider"></div>
                            <div class="meta-item-btn" title="DOI">
                                <div class="meta-item-icon"><i data-lucide="bookmark" size="14"></i></div>
                                <span id="meta-doi-text">...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="desc-content-area block-anim">
                    <div id="rich-text-container">Loading...</div>
                </div>
            </div>
            <div class="panel-anim" id="panel-visual">
                <div class="desc-image-container">
                    <img alt="Project Visual" class="desc-project-img" id="main-project-image" src="">
                </div>
            </div>
            <div class="panel-anim" id="panel-col-desc"></div>
        </div>
    </div>
    <div class="tab-page" id="tab-summary">
        <div class="summary-layout">
            <div class="summary-stats-container block-anim" id="summary-stats-grid"></div>
            <div class="summary-contributors-card block-anim">
                <div class="card-header">
                    <div class="card-title" id="contrib-title"><i data-lucide="users"></i> Project Contributors</div>
                </div>
                <div class="card-body">
                    <div class="contributors-list" id="summary-contributors-list"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-page" id="tab-media">
        <div class="dashboard-card" style="height: 100%;">
            <div class="card-header media-header">
                <div class="media-title"><i data-lucide="music" size="24"></i> Media <span class="media-count-badge" id="media-count-badge">Loading...</span></div>
                <div class="media-controls">
                    <div class="media-search-box"><i class="media-search-icon" data-lucide="search"></i><input class="media-search-input" oninput="handleSearchMedia(this.value)" placeholder="Search media or tags..." type="text"></div>
                    <div class="view-switcher-container">
                        <div class="view-pill" id="view-pill"></div>
                        <button class="view-btn active" onclick="switchMediaView('gallery', this)"><i data-lucide="grid" size="14"></i>Gallery</button>
                        <button class="view-btn" onclick="switchMediaView('list', this)"><i data-lucide="list" size="14"></i> List</button>
                    </div>
                </div>
            </div>
            <div class="card-body media-scroll-area">
                <div class="media-container view-gallery block-anim" id="media-grid-container"></div>
            </div>
        </div>
    </div>
    <div class="tab-page" id="tab-map">
        <div class="map-wrapper">
            <div id="full-map"></div>
            <button class="filter-trigger-btn" id="filter-btn-main" onclick="openFilterDrawer()"><i data-lucide="sliders-horizontal" size="22"></i></button>
            <div class="filter-drawer" id="filter-drawer">
                <div class="fd-header">
                    <div class="fd-title"><i color="var(--brand)" data-lucide="sliders-horizontal" size="20"></i><span>Filters</span></div>
                    <button class="fd-close" onclick="closeFilterDrawer()"><i data-lucide="chevrons-left" size="20"></i></button>
                </div>
                <div class="fd-content">
                    <div class="custom-select-wrapper" id="sel-realm">
                        <div class="select-trigger" onclick="toggleSelect('sel-realm')"><span class="trigger-text" id="text-realm">All Realms</span><i data-lucide="chevron-down" size="16"></i></div>
                        <div class="select-options" id="opt-realm"></div>
                    </div>
                    <div class="custom-select-wrapper" id="sel-biome">
                        <div class="select-trigger disabled" id="trig-biome" onclick="toggleSelect('sel-biome')"><span class="trigger-text" id="text-biome">All Biomes</span><i data-lucide="chevron-down" size="16"></i></div>
                        <div class="select-options" id="opt-biome"></div>
                    </div>
                    <div class="custom-select-wrapper" id="sel-group">
                        <div class="select-trigger disabled" id="trig-group" onclick="toggleSelect('sel-group')"><span class="trigger-text" id="text-group">All Groups</span><i data-lucide="chevron-down" size="16"></i></div>
                        <div class="select-options" id="opt-group"></div>
                    </div>
                    <button class="btn-toolbar" onclick="resetFilters()" style="width: 100%; margin-top: 12px;"><i data-lucide="rotate-ccw" size="16"></i> Reset</button>
                </div>
            </div>
            <div class="sidebar" id="sidebar">
                <div class="sb-header" id="sb-header-bg">
                    <div class="sb-header-content"><h2 class="sb-title" id="sb-name">Site Name</h2>
                        <div class="sb-meta-row" id="sb-meta-container"></div>
                    </div>
                    <button class="sb-close" onclick="closeSidebar()"><i data-lucide="x" size="18"></i></button>
                </div>
                <div class="sb-content">
                    <div class="data-row"><span class="data-label">Realm</span><span class="data-val" id="val-realm">--</span></div>
                    <div class="data-row"><span class="data-label">Biome</span><span class="data-val" id="val-biome">--</span></div>
                    <div class="data-row" style="border-bottom:none;"><span class="data-label">Group</span><span class="data-val" id="val-group">--</span></div>
                    <div class="section-title"><i data-lucide="play-circle" size="16"></i> Media</div>
                    <div class="media-scroll-container" id="media-container"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-page" id="tab-timeline"></div>
    <div class="tab-page" id="tab-data">
        <div class="data-layout-wrapper">
            <div class="data-sidebar">
                <div class="data-sidebar-header"><i data-lucide="database" size="18" style="color:var(--brand);"></i> Tables</div>
                <div class="data-table-list" id="table-nav-list"></div>
            </div>
            <div class="data-main-content">
                <div class="data-toolbar">
                    <div class="card-title" id="current-table-title"><i data-lucide="table"></i> Project</div>
                    <div class="media-controls">
                        <div class="media-search-box"><i class="media-search-icon" data-lucide="search"></i><input class="media-search-input" id="data-search-input" oninput="handleDataSearch(this.value)" placeholder="Search" type="text"></div>
                        <button class="btn-toolbar" onclick="resetDataTable()" title="Reset"><i data-lucide="rotate-ccw" size="16"></i> Reset</button>
                        <button class="btn-toolbar" onclick="openCrudModal('add')"><i data-lucide="plus" size="16"></i> Add</button>
                        <button class="btn-toolbar" disabled id="btn-edit" onclick="handleToolbarEdit()"><i data-lucide="pencil" size="16"></i> Edit</button>
                        <button class="btn-toolbar" disabled id="btn-link" onclick="handleToolbarLink()"><i data-lucide="link" size="16"></i> Link</button>
                        <button class="btn-toolbar" disabled id="btn-reset-pwd" onclick="handleToolbarResetPassword()" style="display:none;"><i data-lucide="key" size="16"></i> Reset Pwd</button>
                        <button class="btn-toolbar" disabled id="btn-permission" onclick="handleToolbarPermission()" style="display:none;"><i data-lucide="shield-check" size="16"></i> Permission</button>
                        <button class="btn-toolbar" disabled id="btn-set-contrib" onclick="handleSetContributor()" style="display:none;"><i data-lucide="user-plus" size="16"></i> Set Role</button>
                        <button class="btn-toolbar danger" disabled id="btn-delete" onclick="handleToolbarDelete()"><i data-lucide="trash-2" size="16"></i> Delete</button>
                    </div>
                </div>
                <div class="data-table-container">
                    <table class="crud-table">
                        <thead id="crud-thead"></thead>
                        <tbody id="crud-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="crud-modal-overlay" id="crud-modal-overlay">
        <div class="crud-modal">
            <div class="card-title" id="modal-title">Edit Item</div>
            <div class="form-grid" id="modal-form-container"></div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeCrudModal()">Cancel</button>
                <button class="btn-primary" id="modal-submit-btn" onclick="saveCrudData()">Save Changes</button>
            </div>
        </div>
    </div>
</div>
<div class="crud-modal-overlay" id="editor-modal-overlay" style="z-index: 10000;">
    <div class="crud-modal" style="width: 800px; max-width: 90vw; transform: translateX(0); left: 50%; top: 50%; bottom: auto; right: auto; border-radius: 16px; transform: translate(-50%, -50%); border-left: none;">
        <div class="card-title" id="editor-title">Edit Description</div>
        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px; min-height: 400px;">
            <div style="background: var(--bg-capsule); padding: 8px; border-radius: 8px; display: flex; gap: 8px; border: 1px solid var(--border-light);">
                <button class="nav-btn-simple" style="width: 32px; height: 32px;"><i data-lucide="bold" size="16"></i></button>
                <button class="nav-btn-simple" style="width: 32px; height: 32px;"><i data-lucide="italic" size="16"></i></button>
                <button class="nav-btn-simple" style="width: 32px; height: 32px;"><i data-lucide="list" size="16"></i></button>
                <div class="nav-divider"></div>
                <button class="nav-btn-simple" style="width: 32px; height: 32px;"><i data-lucide="image" size="16"></i></button>
            </div>
            <textarea id="editor-textarea" style="flex: 1; width: 100%; padding: 16px; border-radius: 8px; border: 1px solid var(--border-light); background: var(--bg-surface); color: var(--text-main); font-family: monospace; line-height: 1.6; resize: none; outline: none; box-sizing: border-box;"></textarea></div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeEditorModal()">Cancel</button>
            <button class="btn-primary" onclick="saveEditorContent()">Confirm</button>
        </div>
    </div>
</div>

<div class="permission-drawer-overlay" id="perm-drawer-overlay" onclick="closePermissionDrawer()"></div>
<div class="permission-drawer" id="perm-drawer">
    <div class="perm-drawer-header">
        <div class="perm-user-info">
            <h2 class="perm-title">Permission Configuration</h2>
            <div class="perm-subtitle" id="perm-user-display">Loading...</div>
        </div>
        <button class="sb-close" onclick="closePermissionDrawer()"><i data-lucide="x" size="20"></i></button>
    </div>
    <div class="perm-drawer-content" id="perm-content-container">
    </div>
    <div class="perm-drawer-footer">
        <button class="btn-secondary" onclick="closePermissionDrawer()">Cancel</button>
        <button class="btn-primary" onclick="savePermissionDrawer()">Save Configuration</button>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script src="data.js"></script>
<script src="project.js"></script>

</body>
</html>